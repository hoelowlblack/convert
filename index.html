<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Convertir une image en WebP</title>
</head>
<body>
    <h1>Uploader une image pour la convertir en WebP</h1>

    <!-- Formulaire d'upload -->
    <input type="file" id="imageInput" accept="image/*" required>
    <button id="convertBtn">Convertir en WebP</button>
    <br><br>

    <!-- Zone de prévisualisation -->
    <img id="preview" style="max-width: 300px; display: none;" alt="Prévisualisation de l'image">
    <br>

    <!-- Lien pour télécharger l'image convertie -->
    <a id="downloadLink" style="display:none;" download="image.webp">Télécharger l'image convertie</a>

    <script>
        document.getElementById('convertBtn').addEventListener('click', function () {
            const input = document.getElementById('imageInput');
            const preview = document.getElementById('preview');
            const downloadLink = document.getElementById('downloadLink');

            if (input.files && input.files[0]) {
                const file = input.files[0];
                const reader = new FileReader();

                reader.onload = function (e) {
                    const img = new Image();
                    img.src = e.target.result;

                    img.onload = function () {
                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Redimensionner l'image à la taille d'origine
                        canvas.width = img.width;
                        canvas.height = img.height;
                        ctx.drawImage(img, 0, 0);

                        // Convertir en WebP
                        canvas.toBlob(function (blob) {
                            // Créer un objet URL pour le téléchargement
                            const url = URL.createObjectURL(blob);
                            
                            // Afficher l'image convertie dans l'élément <img>
                            preview.src = url;
                            preview.style.display = 'block';

                            // Activer le lien de téléchargement
                            downloadLink.href = url;
                            downloadLink.style.display = 'inline';
                        }, 'image/webp', 0.8); // Qualité de compression (0 à 1)
                    };
                };

                reader.readAsDataURL(file);
            }
        });
    </script>

</body>
</html>
